<div class="container text-black">
  <h1 class="text-center">Dashboard
  </h1>

  <div class="col-sm-2" id="la">
    <h4>My projects</h4>
    <% @projects.each do |project| %>
      <%= link_to  project_tasks_path(project_id: project.id) do %>
        <p class='<%= project == @project ? "active" : "" %>'><%= project.name.capitalize %></p>
      <% end %>
    <% end %>
    <%= link_to tasks_path do %>
      <p class='<%= "active" unless params[:project_id].present? %>'>All tasks</p>
    <% end %>
    <%= link_to new_project_path do %>
      Add a new project<i class="fa fa-plus" aria-hidden="true"></i>
    <% end %>
  </div>

  <div class="col-sm-6">
    <% unless @tasks_to_do.empty? %>
      <h4>To do</h4>
      <% @tasks_to_do.each do |task| %>
        <div class="card_task_dashboard">
          <div>
            <b><%= task.name.capitalize %></b>
          </div>
          <div>Estimation: <%= Time.at(task.estimation).utc.strftime("%Hh %Mmin")  %></div>
          <%= link_to edit_project_task_path(task.project, task) do %>
            <i class="fa fa-pencil" aria-hidden="true"></i>
          <% end %>
          <%= link_to project_task_path(task.project.id, task.id), method: :delete, data: { confirm: "Are you sure?" } do %>
            <i class="fa fa-times" aria-hidden="true"></i>
          <% end %>
        </div>
      <% end %>
    <% end %>

    <% unless @tasks_in_progress.empty? %>
      <h4>In progress</h4>
      <% @tasks_in_progress.each do |task| %>
        <div class="card_task_dashboard">
          <div>
            <b><%= task.name.capitalize %></b>
          </div>
          <div>Estimation: <%= Time.at(task.estimation).utc.strftime("%Hh %Mmin") %> </div>
          <div>Time realised: <%= Time.at(task.elapsed_time).utc.strftime("%Hh %Mmin") %></div>
          <%= link_to edit_project_task_path(task.project, task) do %>
            <i class="fa fa-pencil" aria-hidden="true"></i>
          <% end %>
          <%= link_to project_task_path(task.project.id, task.id), method: :delete, data: { confirm: "Are you sure?" } do %>
            <i class="fa fa-times" aria-hidden="true"></i>
          <% end %>
        </div>
      <% end %>
    <% end %>

    <% unless @tasks_finished.empty? %>
      <h4>Finished</h4>
        <% @tasks_finished.each do |task| %>
    <div class="card_task_dashboard">
      <div><b> <%= task.name.capitalize %> </b> </div>
      <div>Estimation: <%= Time.at(task.estimation).utc.strftime("%Hh %Mmin")  %> </div>
      <div>Real time: <%= Time.at(task.elapsed_time).utc.strftime("%Hh %Mmin")  %></div>      <%= link_to edit_project_task_path(task.project, task) do %>
        <i class="fa fa-pencil" aria-hidden="true"></i>
      <% end %>
      <%= link_to project_task_path(task.project.id, task.id), method: :delete, data: { confirm: "Are you sure?" } do %>
        <i class="fa fa-times" aria-hidden="true"></i>
      <% end %>
    </div>
  <% end %>
<% end %>
    <div class="card_task_dashboard">
      <h4 class="text-center">
        Ajouter une t√¢che <i class="fa fa-plus" aria-hidden="true"></i>
      </h4>
      <%= simple_form_for [@project, @task] do |f| %>
        <%= f.input :name, placeholder: "Create a database" %>
        <%= f.input :estimation, minute_step: 15, selected: 1 %>
        <%= f.hidden_field :project_id, value: @project.id %>
        <%= f.submit %>
      <% end %>
    </div>
  </div>

  <div class="col-sm-3" id="la">
    <h4>Data</h4>
    <p>Deadline: <%= @date %></p>
    <p>Progress:</p>
    <div class="clearfix">
      <div class="c100 p<%= @tasks.empty? ? "0" : @pourcent_done.to_i  %> big">
          <span><%= @tasks_done %>/<%= @total_task %></span>
          <div class="slice">
              <div class="bar"></div>
              <div class="fill"></div>
          </div>
      </div>
    </div>

    <p>Total passed in this project: <%= @time_passed  %></p>

    <p>Temps de travail restant √† faire: <%= @time_to_do%> </p>
    <% unless @tasks_finished.empty?  %>
    <% if @prevision < 0
      if Time.at(@prevision).utc.strftime("%H").to_i == 0 %>
      <div class="text-green"> <%= Time.at(@prevision).utc.strftime("+%Mmin") %></div>
      <% else %>
        <div class="text-green"> <%= Time.at(@prevision).utc.strftime("+%Hh %Mmin") %></div>
      <% end %>
    <% elsif @prevision > 0 %>
      <% if Time.at(@prevision).utc.strftime("%H").to_i == 0 %>
        <div class="text-red text-center"><%= Time.at(@prevision).utc.strftime("-%Mmin") %></div>
      <% else %>
        <div class="text-red text-center"><%=Time.at(@prevision).utc.strftime("-%Hh %Mmin")%></div>
      <% end %>
    <% elsif @prevision == 0 %>
    <div class="text-blue text-center">Keep going like that üëç</div>

    <% end %>
    <p>Depassement en euros: ‚Ç¨</p>
    <% end %>
  </div>

</div>
